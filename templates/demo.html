

<!DOCTYPE HTML>
<html>
    <head>
        <title>Demo - background worker</title>

        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
        <!--script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script-->
        <!--script src="/socket.io/socket.io.js"></script-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>

        <script type="text/javascript" charset="utf-8">

            $(document).ready(function() {

                var socketio = null;
                var namespace = "/work"
                $("input[name='connect']").on("click", function() {

                    console.log("connect");

                    socketio = io(namespace);

                    socketio.off().on("re_connect", function(msg) {
                        $(".report").append(msg.msg + "<br />");
                    });
                    socketio.on("update", function(msg) {
                        $(".report").append(msg.msg + "<br />");
                    });
                });

                $("input[name='update']").on("click", function() {
                    var mode = $("input[name='mode']")['0'].value;
                    var colour = $("input[name=colour]")['0'].value;
                    var value = $("input[name='colori']")['0'].value;
                    // #XXXXXX -> ["XX", "XX", "XX"]
                    value = value.match(/[A-Za-z0-9]{2}/g);

                    // ["XX", "XX", "XX"] -> [n, n, n]
                    value = value.map(function(v) { return parseInt(v, 16) });
                    socketio.emit("update", {'r':value[0],'g':value[1],'b':value[2],'mode':mode,'colour':colour});
                });


            });

        </script>

    </head>

    <body>
        <div class="main_container" >

            <div class="control">

                <form id="ctrl_form">
                    <input type="button" name="connect" value="connect" />
                    <input type="button" name="update" value="update" />
                    <input type="color" name="colori" value="#000000" />
                    <label>mode</label>
                    <input type="number" name="mode" value="0" min="0" max="4" />
                    <label>colour</label>
                    <input type="number" name="colour" value="0" min="0" max="3" />
                 </form>
            </div>
            <ul>
                <li>mode 0: colorWipe preset colour (1:red 2:green 3:blue 4:white)/li>
                <li>mode 1: theaterChase</li>
                <li>mode 2: rainbow</li>
                <li>mode 3: rainbowCycle</li>
                <li>mode 4: theaterChaseRainbow</li>
                <li>mode 5: colorWipe custom colour</li>
            </ul>
            <div class="report">
                ...
            </div>
        </div>
    </body>
</html>
